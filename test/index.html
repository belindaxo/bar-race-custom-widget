<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Bar Race Chart with Play Button & Slider</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
</head>

<body>
    <div id="parent-container">
        <div id="play-controls">
            <button id="play-pause-button" title="play" style="margin-left: 10px; width: 45px; height: 45px; cursor: pointer; border: none;
                        border-radius: 0; color: #004b8d; background-color: transparent; font-size: 24px;">▶</button>
            <input id="play-range" type="range" value="1960" min="1960" max="2022" style="transform: translateY(2.5px); width: calc(100% - 90px); background: #f8f8f8;"/>
        </div>
        <div id="container"></div>
    </div>

    <script>
        const startYear = 1960,
            endYear = 2022,
            btn = document.getElementById('play-pause-button'),
            input = document.getElementById('play-range'),
            nbr = 20;

        let dataset, chart;


        /*
         * Animate dataLabels functionality
         */
        (function (H) {
            const FLOAT = /^-?\d+\.?\d*$/;

            // Add animated textSetter, just like fill/strokeSetters
            H.Fx.prototype.textSetter = function () {
                const chart = H.charts[this.elem.renderer.chartIndex];

                let thousandsSep = chart.numberFormatter('1000.0')[1];

                if (/[0-9]/.test(thousandsSep)) {
                    thousandsSep = ' ';
                }

                const replaceRegEx = new RegExp(thousandsSep, 'g');

                let startValue = this.start.replace(replaceRegEx, ''),
                    endValue = this.end.replace(replaceRegEx, ''),
                    currentValue = this.end.replace(replaceRegEx, '');

                if ((startValue || '').match(FLOAT)) {
                    startValue = parseInt(startValue, 10);
                    endValue = parseInt(endValue, 10);

                    // No support for float
                    currentValue = chart.numberFormatter(
                        Math.round(startValue + (endValue - startValue) * this.pos),
                        0
                    );
                }

                this.elem.endText = this.end;

                this.elem.attr(this.prop, currentValue, null, true);
            };

            // Add textGetter, not supported at all at this moment:
            H.SVGElement.prototype.textGetter = function () {
                const ct = this.text.element.textContent || '';
                return this.endText ? this.endText : ct.substring(0, ct.length / 2);
            };

            // Temporary change label.attr() with label.animate():
            // In core it's simple change attr(...) => animate(...) for text prop
            H.wrap(H.Series.prototype, 'drawDataLabels', function (proceed) {
                const attr = H.SVGElement.prototype.attr,
                    chart = this.chart;

                if (chart.sequenceTimer) {
                    this.points.forEach(point =>
                        (point.dataLabels || []).forEach(
                            label =>
                            (label.attr = function (hash) {
                                if (
                                    hash &&
                                    hash.text !== undefined &&
                                    chart.isResizing === 0
                                ) {
                                    const text = hash.text;

                                    delete hash.text;

                                    return this
                                        .attr(hash)
                                        .animate({ text });
                                }
                                return attr.apply(this, arguments);

                            })
                        )
                    );
                }

                const ret = proceed.apply(
                    this,
                    Array.prototype.slice.call(arguments, 1)
                );

                this.points.forEach(p =>
                    (p.dataLabels || []).forEach(d => (d.attr = attr))
                );

                return ret;
            });
        }(Highcharts));


        function getData(year) {
            const output = Object.entries(dataset)
                .map(country => {
                    const [countryName, countryData] = country;
                    return [countryName, Number(countryData[year])];
                })
                .sort((a, b) => b[1] - a[1]);
            return [output[0], output.slice(1, nbr)];
        }

        function getSubtitle() {
            const population = (getData(input.value)[0][1] / 1000000000).toFixed(2);
            return `<span style="font-size: 80px">${input.value}</span>
        <br>
        <span style="font-size: 22px">
            Total: <b>: ${population}</b> billion
        </span>`;
        }

        (async () => {

            dataset = await fetch(
                'https://demo-live-data.highcharts.com/population.json'
            ).then(response => response.json());


            chart = Highcharts.chart('container', {
                chart: {
                    animation: {
                        duration: 500
                    },
                    marginRight: 50
                },
                title: {
                    text: 'World population by country',
                    align: 'left'
                },
                subtitle: {
                    text: getSubtitle(),
                    floating: true,
                    align: 'right',
                    verticalAlign: 'middle',
                    useHTML: true,
                    y: 100,
                    x: -20
                },

                legend: {
                    enabled: false
                },
                xAxis: {
                    type: 'category',
                    title: {
                        text: 'HELLO'
                    }
                },
                yAxis: {
                    opposite: true,
                    tickPixelInterval: 150,
                    title: {
                        text: 'Hello'
                    }
                },
                plotOptions: {
                    series: {
                        animation: false,
                        groupPadding: 0,
                        pointPadding: 0.1,
                        borderWidth: 0,
                        colorByPoint: true,
                        dataSorting: {
                            enabled: true,
                            matchByName: true
                        },
                        type: 'bar',
                        dataLabels: {
                            enabled: true,
                            allowOverlap: true,
                        }
                    }
                },
                series: [
                    {
                        type: 'bar',
                        name: startYear,
                        data: getData(startYear)[1]
                    }
                ],
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 550
                        },
                        chartOptions: {
                            xAxis: {
                                visible: false
                            },
                            subtitle: {
                                x: 0
                            },
                            plotOptions: {
                                series: {
                                    dataLabels: [{
                                        enabled: true,
                                        y: 8
                                    }, {
                                        enabled: true,
                                        format: '{point.name}',
                                        y: -8,
                                        style: {
                                            fontWeight: 'normal',
                                            opacity: 0.7
                                        }
                                    }]
                                }
                            }
                        }
                    }]
                }
            });
        })();

        /*
         * Pause the timeline, either when the range is ended, or when clicking the
         * pause button. Pausing stops the timer and resets the button to play mode.
         */
        function pause(button) {
            button.title = 'play';
            button.innerText = '▶';
            button.style.fontSize = '24px';
            clearTimeout(chart.sequenceTimer);
            chart.sequenceTimer = undefined;
        }

        /*
         * Update the chart. This happens either on updating (moving) the range input,
         * or from a timer when the timeline is playing.
         */
        function update(increment) {
            if (increment) {
                input.value = parseInt(input.value, 10) + increment;
            }
            if (input.value >= endYear) {
                // Auto-pause
                pause(btn);
            }

            chart.update(
                {
                    subtitle: {
                        text: getSubtitle()
                    }
                },
                false,
                false,
                false
            );

            chart.series[0].update({
                name: input.value,
                data: getData(input.value)[1]
            });
        }

        /*
         * Play the timeline.
         */
        function play(button) {
            button.title = 'pause';
            button.innerText = '⏸';
            button.style.fontSize = '24px';
            chart.sequenceTimer = setInterval(function () {
                update(1);
            }, 500);
        }

        btn.addEventListener('click', function () {
            if (chart.sequenceTimer) {
                pause(this);
            } else {
                play(this);
            }
        });
        /*
         * Trigger the update on the range bar click.
         */
        input.addEventListener('click', function () {
            update();
        });
    </script>
    <form id="form">
        <legend style="font-weight: bold;font-size: 18px;"> Font </legend>
        <table>
            <tr>
                <td>Chart Title</td>
            </tr>
            <tr>
                <td><input id="chartTitle" type="text"></td>
            </tr>
            <tr>
                <table>
                    <tr>
                        <td>Size</td>
                        <td>Font Style</td>
                        <td>Alignment</td>
                        <td>Color</td>
                    </tr>
                    <tr>
                        <td>
                            <select id="titleSize">
                                <option value="10px">10</option>
                                <option value="12px">12</option>
                                <option value="14px">14</option>
                                <option value="16px" selected>16</option>
                                <option value="18px">18</option>
                                <option value="20px">20</option>
                                <option value="22px">22</option>
                                <option value="24px">24</option>
                                <option value="32px">32</option>
                                <option value="48px">48</option>
                            </select>
                        </td>
                        <td>
                            <select id="titleFontStyle">
                                <option value="normal">Normal</option>
                                <option value="bold" selected>Bold</option>
                            </select>
                        </td>
                        <td>
                            <select id="titleAlignment">
                                <option value="left" selected>Left</option>
                                <option value="center">Center</option>
                                <option value="right">Right</option>
                            </select>
                        </td>
                        <td>
                            <input id="titleColor" type="color" value="#004B8D">
                        </td>
                    </tr>
                </table>
            </tr>
        </table>
        <legend style="font-weight: bold;font-size: 18px; margin-top: 10px;"> Subtitle Properties</legend>
        <table>
            <tr>
                <td> Date Size</td>
            </tr>
            <tr>
                <td>
                    <select id="subtitleDateSize">
                        <option value="10px">10</option>
                        <option value="12px">12</option>
                        <option value="14px">14</option>
                        <option value="16px">16</option>
                        <option value="18px">18</option>
                        <option value="20px">20</option>
                        <option value="22px" selected>22</option>
                        <option value="24px">24</option>
                        <option value="32px">32</option>
                        <option value="48px">48</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td> Total Size</td>
            </tr>
            <tr>
                <td>
                    <select id="subtitleTotalSize">
                        <option value="10px">10</option>
                        <option value="12px">12</option>
                        <option value="14px">14</option>
                        <option value="16px">16</option>
                        <option value="18px">18</option>
                        <option value="20px">20</option>
                        <option value="22px">22</option>
                        <option value="24px" selected>24</option>
                        <option value="32px">32</option>
                        <option value="48px">48</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td> X Position</td>
                <td> Y Position</td>
            </tr>
            <tr>
                <td>
                    <input id="subtitleX" type="number" value="-20" style="width: 60px;">
                </td>
                <td>
                    <input id="subtitleY" type="number" value="100" style="width: 60px;">
                </td>
            </tr>
        </table>
        <legend style="font-weight: bold;font-size: 18px; margin-top: 10px;"> Number Formatting </legend>
        <table>
            <tr>
                <td>Scale Format</td>
            </tr>
            <tr>
                <td>
                    <select id="scaleFormat">
                        <option value="unformatted" selected>Unformatted</option>
                        <option value="k">Thousands (k)</option>
                        <option value="m">Millions (m)</option>
                        <option value="b">Billions (b)</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Decimal Places</td>
            </tr>
            <tr>
                <td>
                    <select id="decimalPlaces">
                        <option value="0" selected>0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </td>
            </tr>
        </table>
        <tr>
            <button id="resetDefaults" type="button" style="margin-top: 10px; margin-bottom: 10px;">Reset to Default</button>
        </tr>
        <input type="submit" style="display:none;">
        </form>
</body>

</html>